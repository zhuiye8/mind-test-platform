# 教师端学生监控功能使用指南

## 功能概述

教师端现已升级为支持实时监控学生考试情况的界面。在原有本地检测功能的基础上，新增了学生监控模式，可以：

- 实时监控连接到系统的学生
- 查看学生的视音频流
- 监控学生的情绪状态和心率数据
- 在本地检测和学生监控之间无缝切换

## 界面说明

### 1. 模式切换
在页面顶部有两个模式按钮：
- **本地检测**：使用本地摄像头和麦克风进行情绪检测
- **学生监控**：监控学生端传来的数据

### 2. 学生监控模式界面

切换到学生监控模式后，左侧面板包含：

#### 学生监控状态
- 在线学生数量
- 活跃会话数量
- 刷新列表按钮

#### 学生列表
- 显示所有连接的学生
- 学生ID、考试ID、连接时间
- 学生状态（在线/检测中）
- 点击学生可选择监控对象

#### 当前监控学生信息
- 当前监控的学生详细信息
- 连接时长
- 断开连接按钮

### 3. 检测结果显示

右侧面板实时显示当前监控学生的：
- 面部情绪分析结果
- 语音情绪分析结果
- 心率检测数据
- 情绪变化趋势图

## 使用步骤

### 启动系统
1. 运行 `python app_lan.py` 启动局域网服务器
2. 等待AI模型加载完成
3. 打开浏览器访问显示的局域网地址

### 监控学生
1. 点击页面顶部的"学生监控"按钮
2. 等待学生端连接（学生需要调用API创建会话）
3. 在学生列表中点击要监控的学生
4. 观察右侧实时检测结果

### 切换模式
- 随时可以点击"本地检测"按钮切换回本地模式
- 切换时会自动停止当前活动并清空检测结果

## API接口说明

### 学生端需要调用的接口

1. **创建检测会话**
   ```
   POST /api/create_session
   Content-Type: application/json
   
   {
     "student_id": "学生ID",
     "exam_id": "考试ID"
   }
   ```

2. **发送视音频数据**
   通过WebSocket发送：
   - `video_frame`: 视频帧数据
   - `audio_data`: 音频数据

3. **停止检测**
   ```
   POST /api/end_session
   Content-Type: application/json
   
   {
     "session_id": "会话ID"
   }
   ```

4. **生成心理报告**
   ```
   POST /api/analyze_questions
   Content-Type: application/json
   
   {
     "session_id": "会话ID",
     "questions_data": [
       {
         "question_id": "题目ID",
         "content": "题目内容",
         "start_time": "开始时间",
         "end_time": "结束时间"
       }
     ]
   }
   ```

### 教师端专用接口

1. **获取学生会话列表**
   ```
   GET /api/student_sessions
   ```

2. **健康检查**
   ```
   GET /api/health
   ```

## WebSocket事件

### 教师端监听的事件
- `student_connected`: 学生连接
- `student_detection_stopped`: 学生停止检测
- `student_video_stream`: 学生视频流
- `student_audio_stream`: 学生音频流
- `student_video_emotion_result`: 学生视频情绪分析结果
- `student_audio_emotion_result`: 学生音频情绪分析结果
- `student_heart_rate_result`: 学生心率检测结果

## 测试方法

### 1. 使用测试脚本
运行 `python simple_test.py` 测试基础API功能

### 2. 使用测试页面
打开 `test_monitor.html` 测试前端界面功能

### 3. 手动测试
1. 启动教师端系统
2. 使用Postman或其他工具模拟学生端API调用
3. 观察教师端界面变化

## 注意事项

1. **网络要求**：确保学生端和教师端在同一局域网内
2. **浏览器兼容性**：推荐使用Chrome、Firefox等现代浏览器
3. **权限要求**：本地检测模式需要摄像头和麦克风权限
4. **性能考虑**：同时监控多个学生可能影响性能
5. **数据安全**：所有检测数据仅存储在教师端，不会传输给学生端

## 故障排除

### 学生列表为空
- 检查学生端是否正确调用了创建会话API
- 检查网络连接是否正常
- 查看服务器控制台输出

### 无法切换模式
- 确保当前没有正在进行的检测任务
- 刷新页面重新加载

### 检测结果不显示
- 确保已选择要监控的学生
- 检查学生端是否正在发送视音频数据
- 查看浏览器控制台是否有错误信息

## 技术支持

如遇到问题，请：
1. 查看服务器控制台输出
2. 检查浏览器控制台错误信息
3. 确认API调用返回的错误信息
4. 验证网络连接和防火墙设置